<!-- UserManagement/profile.html -->

{% extends 'UserManagement/base.html' %}
{% load static %}

{% block content %}
<style>
    .profile-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 20px;
        background-color: #f8f9fa;
    }

    .profile-info {
        flex-grow: 1;
        padding: 0 20px;
    }

    .user-actions {
        display: flex;
        gap: 10px;
    }

    .posts-grid {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        padding: 20px;
    }

    .post {
        position: relative;
        background-size: cover;
        background-position: center;
        aspect-ratio: 1;
    }

    .post-overlay {
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.4);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .post:hover .post-overlay {
        opacity: 1;
    }
</style>

<div class="profile-header">
    <div class="profile-info">
        <h1>{{ user.display_name }}'s Profile</h1>
        <p>Email: {{ user.email }}</p>
        <p>Join date: {{ user.date_joined|date:"Y-m-d" }}</p>
        <p>Bio: {{ user.about_me }}</p>
        <p>
            <a href="{% url 'UserManagement:followers_list' user.id %}">
                Followers: {{ followers.count }}
            </a>
        </p>
        <p>
            <a href="{% url 'UserManagement:following_list' user.slug %}">
                Following: {{ following.count }}
            </a>
        </p>
    </div>
    <div class="user-actions">

        <a href="{% url 'UserManagement:edit_profile' slug=user.slug %}" class="btn btn-primary">Edit Profile</a>
        <a href="{% url 'UserManagement:pets' %}" class="btn btn-info">Pets</a>
        <a href="{% url 'UserManagement:friends' %}" class="btn btn-success">Friends</a>
        {% if user != request.user %}
        <button id="follow-btn" data-user-id="{{ user.id }}" class="btn {% if is_following %}btn-secondary{% else %}btn-primary{% endif %}">
            {% if is_following %}
                Following
            {% else %}
                Follow
            {% endif %}
        </button>
        {% endif %}
    </div>
</div>

{% if posts %}
    <div class="posts-grid">
        {% for post in posts %}
        <div class="post" style="background-image: url('{{ post.image.url }}');">
            <div class="post-overlay">{{ post.caption }}</div>
        </div>
        {% endfor %}
    </div>
{% else %}
    <p>No posts available.</p>
{% endif %}

<script>
document.getElementById("follow-btn").addEventListener("click", function() {
    var button = this;
    var userId = button.getAttribute("data-user-id");

    fetch(`/user/follow_user/${userId}/`)
        .then(response => response.json())
        .then(data => {
            if (data.is_following) {
                button.textContent = "Following";
                button.classList.replace("btn-primary", "btn-secondary");
            } else {
                button.textContent = "Follow";
                button.classList.replace("btn-secondary", "btn-primary");
            }
        });
});
</script>

{% endblock %}
